#
# Makefile for Nucleus Utilities
# You must run ./configure to generate needed configuration
#

PROGS = cat \
	echo \
	false \
	link \
	logname \
	printenv \
	pwd \
	true \
	unlink \
	yes

PROGS_OBJ = $(PROGS:=.o)
PROGS_SRC = $(PROGS:=.S)

LIB_SRC = strlen.S
LIB_OBJ = $(LIB_SRC:.S=.o)

#
# Verbose options
#
V_default = 0
LD_verbose = ${LD_verbose_${V}}
LD_verbose_ = ${LD_verbose_${V_default}}
LD_verbose_0 = @echo "  LD  $@";
LD_verbose_1 =
CC_verbose = ${CC_verbose_${V}}
CC_verbose_ = ${CC_verbose_${V_default}}
CC_verbose_0 = @echo "  CC  $@";
CC_verbose_1 =
RANLIB_verbose = ${RANLIB_verbose_${V}}
RANLIB_verbose_ = ${RANLIB_verbose_${V_default}}
RANLIB_verbose_0 = @echo "  RANLIB  $@";
RANLIB_verbose_1 =

VPATH = $(srcdir)/$(host_cpu):$(srcdir)/$(host_cpu)/lib

assembler.cmd = ${CC_verbose}${CC} ${CFLAGS} ${CPPFLAGS} -I$(srcdir)/$(host_cpu) -c -o $@ $<
linker.cmd = ${LD_verbose}${LD} ${LDFLAGS} -o $@ $^

.SUFFIXES:
.SUFFIXES: .S .o

.PHONY: all clean clean.lib clean.progs clean.obj

#
# Makefile rules start here
#
all: $(PROGS)

.S.o:
	$(assembler.cmd)

$(PROGS_OBJ): $(srcdir)/$(host_cpu)/inc/syscall.h $(srcdir)/$(host_cpu)/inc/sysdep.h Makefile

cat: cat.o strlen.o
	$(linker.cmd)

echo: echo.o strlen.o
	$(linker.cmd)

false: false.o
	$(linker.cmd)

link: link.o
	$(linker.cmd)

logname: logname.o strlen.o
	$(linker.cmd)

printenv: printenv.o strlen.o
	$(linker.cmd)

pwd: pwd.o strlen.o
	$(linker.cmd)

true: true.o
	$(linker.cmd)

unlink: unlink.o
	$(linker.cmd)

yes: yes.o strlen.o
	$(linker.cmd)

clean: clean.lib clean.progs clean.obj

clean.lib:
	$(RM) -rf $(LIB_OBJ)

clean.progs:
	$(RM) -rf $(PROGS)

clean.obj:
	$(RM) -rf $(PROGS_OBJ)

distclean: clean
	$(RM) -rf Makefile

Makefile: $(srcdir)/configure $(srcdir)/Makefile.in
	$(srcdir)/configure $(configure_options)
