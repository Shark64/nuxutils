#
# Makefile for Nucleus Utilities
# You must run ./configure to generate needed configuration
#

PROGS = basename \
	cat \
	chroot \
	echo \
	env \
	false \
	link \
	logname \
	mkdir \
	printenv \
	pwd \
	rmdir \
	sleep \
	sync \
	tee \
	true \
	unlink \
	yes

PROGS_OBJ = $(PROGS:=.o)
PROGS_SRC = $(PROGS:=.S)

LIB = lib/libutil.a
LIB_CPPFLAGS = -I$(top_srcdir)/lib/$(host_cpu)

#
# Verbose options
#
V_default = 0
verbose = ${verbose_${V}}
verbose_ = ${verbose_${V_default}}
verbose_0 = @
verbose_1 =
LD_verbose = ${LD_verbose_${V}}
LD_verbose_ = ${LD_verbose_${V_default}}
LD_verbose_0 = @echo "  LD  $@";
LD_verbose_1 =
CC_verbose = ${CC_verbose_${V}}
CC_verbose_ = ${CC_verbose_${V_default}}
CC_verbose_0 = @echo "  CC  $@";
CC_verbose_1 =

VPATH = $(srcdir)

assembler.cmd = ${CC_verbose}${CC} ${CFLAGS} ${CPPFLAGS} $(LIB_CPPFLAGS) -c -o $@ $<
linker.cmd = ${LD_verbose}${CC} -nostdlib -o $@ $^

.SUFFIXES:
.SUFFIXES: .S .o

.PHONY: all clean clean.lib clean.progs clean.obj distclean distclean.lib

#
# Makefile rules start here
#
all: $(LIB) $(PROGS)

$(LIB): lib/Makefile
	$(verbose)$(MAKE) -C lib

.S.o:
	$(assembler.cmd)

$(PROGS_OBJ): $(srcdir)/syscall.h $(srcdir)/sysdep.h Makefile

$(PROGS): $(LIB)

basename: basename.o
	$(linker.cmd)

cat: cat.o
	$(linker.cmd)

chroot: chroot.o
	$(linker.cmd)

echo: echo.o
	$(linker.cmd)

env: env.o
	$(linker.cmd)

false: false.o
	$(linker.cmd)

link: link.o
	$(linker.cmd)

logname: logname.o
	$(linker.cmd)

mkdir: mkdir.o
	$(linker.cmd)

printenv: printenv.o
	$(linker.cmd)

pwd: pwd.o
	$(linker.cmd)

rmdir: rmdir.o
	$(linker.cmd)

sleep: sleep.o
	$(linker.cmd)

sync: sync.o
	$(linker.cmd)

tee: tee.o
	$(linker.cmd)

true: true.o
	$(linker.cmd)

unlink: unlink.o
	$(linker.cmd)

yes: yes.o
	$(linker.cmd)

clean: clean.lib clean.progs clean.obj

clean.lib:
	$(verbose)$(MAKE) -C lib clean

clean.progs:
	$(RM) $(PROGS)

clean.obj:
	$(RM) $(PROGS_OBJ)

distclean: distclean.lib clean.progs clean.obj
	$(RM) Makefile

distclean.lib:
	$(verbose)$(MAKE) -C lib distclean

Makefile: $(top_srcdir)/configure $(top_srcdir)/Makefile.in
	$(top_srcdir)/configure $(configure_options)

lib/Makefile: $(top_srcdir)/configure $(top_srcdir)/lib/Makefile.in
	$(top_srcdir)/configure $(configure_options)
